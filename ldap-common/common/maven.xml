<project 
  xmlns:j="jelly:core"
  xmlns:u="jelly:util"
  xmlns:ant="jelly:ant"
  xmlns:deploy="deploy">

  <!-- TODO: replace with eve plugin/antlr plugin? -->
  <preGoal name="java:compile">
    <attainGoal name="antlr:generate-all"/>
  </preGoal>        
  
  <postGoal name="eclipse">
    <attainGoal name="antlr:generate-all"/>
  </postGoal>
  
  <goal name="antlr:generate-all">
    <!-- Produces 
    target/antlr/org/apache/common/name/antlrValueTokenTypes.txt 
    -->
    <copy file="${basedir}/src/antlr/DnCommonTokenTypes.txt" toDir="${user.dir}"/>
    <j:set var="maven.antlr.grammars" value="valuelexer.g"/>
    <attainGoal name="antlr:generate" />
    
    <j:set var="maven.antlr.grammars" value="valueparser.g"/>
    <attainGoal name="antlr:generate" />
    
    <j:set var="maven.antlr.grammars" value="typelexer.g"/>
    <attainGoal name="antlr:generate" />

    <j:set var="maven.antlr.grammars" value="dnparser.g"/>
    <attainGoal name="antlr:generate" />

    <j:set var="maven.antlr.grammars" value="filter-value-lexer.g"/>
    <attainGoal name="antlr:generate" />

    <j:set var="maven.antlr.grammars" value="filter-lexer.g"/>
    <attainGoal name="antlr:generate" />

    <j:set var="maven.antlr.grammars" value="filter-value-parser.g"/>
    <attainGoal name="antlr:generate" />

    <j:set var="maven.antlr.grammars" value="filter-parser.g"/>
    <attainGoal name="antlr:generate" />

    <delete file="${user.dir}/DnCommonTokenTypes.txt"/>
    <delete file="${user.dir}/antlrValueTokenTypes.txt"/>

    <j:set var="maven.antlr.grammars" value="subtree-specification.g"/>
    <attainGoal name="antlr:generate" />
    
    <j:set var="maven.antlr.grammars" value="ACIItem.g"/>
    <attainGoal name="antlr:generate" />
    
  </goal>

  <preGoal name="jar:jar">
    <copy
      file="${basedir}/src/antlr/DnCommonTokenTypes.txt"
      toDir="${basedir}/target/classes/org/apache/ldap/common/name"
      />
    <copy
      file="${basedir}/target/antlr/org/apache/ldap/common/name/antlrNameParserTokenTypes.txt"
      toDir="${basedir}/target/classes/org/apache/ldap/common/name"
      />
    <copy
      file="${basedir}/target/antlr/org/apache/ldap/common/name/antlrTypeTokenTypes.txt"
      toDir="${basedir}/target/classes/org/apache/ldap/common/name"
      />
    <copy
      file="${basedir}/target/antlr/org/apache/ldap/common/name/antlrValueParserTokenTypes.txt"
      toDir="${basedir}/target/classes/org/apache/ldap/common/name"
      />
    <copy
      file="${basedir}/target/antlr/org/apache/ldap/common/name/antlrValueTokenTypes.txt"
      toDir="${basedir}/target/classes/org/apache/ldap/common/name"
      />
    <copy
      file="${basedir}/target/antlr/org/apache/ldap/common/filter/AntlrFilterValueParserTokenTypes.txt"
      toDir="${basedir}/target/classes/org/apache/ldap/common/filter"
      />
    <copy
      file="${basedir}/target/antlr/org/apache/ldap/common/filter/FilterValueLexerTokenTypes.txt"
      toDir="${basedir}/target/classes/org/apache/ldap/common/filter"
      />
    <copy
      file="${basedir}/target/antlr/org/apache/ldap/common/filter/AntlrFilterParserTokenTypes.txt"
      toDir="${basedir}/target/classes/org/apache/ldap/common/filter"
      />
    <copy
      file="${basedir}/target/antlr/org/apache/ldap/common/filter/FilterLexerTokenTypes.txt"
      toDir="${basedir}/target/classes/org/apache/ldap/common/filter"
      />
  </preGoal>
    
</project>

